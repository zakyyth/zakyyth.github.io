<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laanqari Aisha High School</title>
  <style>
    /* ===== Reset & Base ===== */
    * {margin:0; padding:0; box-sizing:border-box;}
    html {scroll-behavior: smooth;}
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(180deg, #f4f4f9, #e2e4f5);
      color: #333;
      line-height: 1.6;
    }

    /* ===== Login Page ===== */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      position: relative;
      overflow: hidden;
    }
    .login-box {
      background: white;
      padding: 50px 40px;
      border-radius: 20px;
      box-shadow: 0 15px 50px rgba(0,0,0,0.3);
      max-width: 450px;
      width: 90%;
      position: relative;
      z-index: 1;
      animation: slideUp 0.6s ease-out;
    }
    @keyframes slideUp {
      from {opacity: 0; transform: translateY(30px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .login-header {
      text-align: center;
      margin-bottom: 35px;
    }
    .login-header h1 {
      color: #2a2d8f;
      font-size: 2em;
      margin-bottom: 10px;
    }
    .login-header p {
      color: #666;
      font-size: 1em;
    }
    .login-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 25px;
      position: relative;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #2a2d8f;
      font-weight: 600;
      font-size: 0.95em;
    }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 14px 15px 14px 45px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s;
      background: #f9f9f9;
    }
    .form-group textarea {
      padding: 14px 15px;
      resize: vertical;
      min-height: 100px;
    }
    .form-group select {
      padding: 14px 15px;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: #2a2d8f;
      box-shadow: 0 0 15px rgba(42,45,143,0.2);
      background: white;
    }
    .form-group .icon {
      position: absolute;
      left: 15px;
      top: 42px;
      font-size: 1.2em;
      color: #2a2d8f;
    }
    .login-btn, .btn-primary {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(42,45,143,0.4);
    }
    .login-btn:hover, .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(42,45,143,0.5);
    }
    .user-type-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }
    .user-type-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid #ddd;
      background: white;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      color: #666;
    }
    .user-type-btn.active {
      border-color: #2a2d8f;
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
    }
    .login-footer {
      text-align: center;
      margin-top: 25px;
      color: #666;
      font-size: 0.9em;
    }
    .login-footer a {
      color: #2a2d8f;
      text-decoration: none;
      font-weight: 600;
    }
    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #f5c6cb;
      display: none;
    }
    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #c3e6cb;
      display: none;
    }

    /* ===== Main Website Styles ===== */
    .main-website {
      display: none;
    }
    header {
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
      padding: 30px 20px;
      text-align: center;
      position: relative;
    }
    header h1 {
      font-size:2.5em;
      position: relative;
    }
    header p {
      font-size:1.1em; 
      opacity:0.9;
      position: relative;
    }
    .user-info {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      padding: 10px 20px;
      border-radius: 25px;
      backdrop-filter: blur(10px);
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .user-info span {
      font-weight: bold;
      cursor: pointer;
    }
    .notification-bell {
      position: relative;
      cursor: pointer;
      font-size: 1.3em;
    }
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4444;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .logout-btn {
      background: white;
      color: #2a2d8f;
      border: none;
      padding: 6px 15px;
      border-radius: 15px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    .logout-btn:hover {
      background: #f0f0f0;
      transform: scale(1.05);
    }

    /* ===== Navigation ===== */
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: #4446b1;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    nav a {
      color: white;
      padding: 16px 20px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s;
      position: relative;
      cursor: pointer;
    }
    nav a.active {
      background: rgba(255,255,255,0.2);
      border-bottom: 3px solid white;
    }
    nav a:hover {
      background: rgba(255,255,255,0.1);
    }

    /* ===== Search Bar ===== */
    .search-container {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 20px;
    }
    .search-bar {
      width: 100%;
      padding: 15px 20px 15px 50px;
      border: 2px solid #ddd;
      border-radius: 25px;
      font-size: 1em;
      background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%232a2d8f" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 15px center;
      transition: all 0.3s;
    }
    .search-bar:focus {
      outline: none;
      border-color: #2a2d8f;
      box-shadow: 0 0 15px rgba(42,45,143,0.2);
    }

    /* ===== Main Content ===== */
    main {padding: 30px 20px; max-width: 1100px; margin: auto; min-height: calc(100vh - 300px);}
    .page {
      display: none;
      animation: fadeIn 0.5s ease-out;
    }
    .page.active {
      display: block;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }
    
    h2 {
      color: #2a2d8f;
      border-bottom: 3px solid #2a2d8f;
      padding-bottom: 10px;
      margin-bottom: 25px;
      font-size: 2em;
      display: inline-block;
    }

    /* ===== Cards ===== */
    .card {
      background: white;
      padding: 25px;
      margin: 15px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-radius: 15px;
      transition: all 0.4s;
      border-left: 5px solid #2a2d8f;
      position: relative;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(42,45,143,0.3);
    }
    .card h3 {
      color: #2a2d8f;
      margin-bottom: 10px;
      font-size: 1.4em;
    }
    .card p {
      color: #555;
      line-height: 1.7;
    }
    .card .badge {
      display: inline-block;
      background: #2a2d8f;
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      margin-top: 10px;
      margin-right: 5px;
    }
    .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
      font-size: 0.9em;
      color: #666;
    }
    .card-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .btn-small {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      font-size: 0.9em;
    }
    .btn-like {
      background: #e8f4fd;
      color: #2a8fdb;
    }
    .btn-like:hover {
      background: #2a8fdb;
      color: white;
    }
    .btn-like.liked {
      background: #2a8fdb;
      color: white;
    }
    .btn-comment {
      background: #fff3cd;
      color: #856404;
    }
    .btn-comment:hover {
      background: #856404;
      color: white;
    }
    .btn-delete {
      background: #f8d7da;
      color: #721c24;
    }
    .btn-delete:hover {
      background: #721c24;
      color: white;
    }
    .btn-download {
      background: #d4edda;
      color: #155724;
    }
    .btn-download:hover {
      background: #155724;
      color: white;
    }

    /* ===== Profile Card ===== */
    .profile-card {
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      margin-bottom: 30px;
    }
    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: white;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      color: #2a2d8f;
    }
    .profile-info h2 {
      color: white;
      border: none;
      margin-bottom: 10px;
    }

    /* ===== Calendar ===== */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .calendar-day {
      background: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #eee;
      cursor: pointer;
      transition: all 0.3s;
    }
    .calendar-day:hover {
      border-color: #2a2d8f;
      transform: scale(1.05);
    }
    .calendar-day.has-event {
      background: #e8f4fd;
      border-color: #2a8fdb;
    }
    .calendar-day.today {
      background: #2a2d8f;
      color: white;
    }

    /* ===== Homework Card ===== */
    .homework-card {
      border-left-color: #ff9800;
    }
    .homework-card.submitted {
      border-left-color: #4caf50;
      background: #f1f8f4;
    }
    .homework-card.overdue {
      border-left-color: #f44336;
      background: #ffebee;
    }

    /* ===== Poll Card ===== */
    .poll-option {
      background: #f9f9f9;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    .poll-option:hover {
      background: #e8f4fd;
    }
    .poll-option.selected {
      background: #2a8fdb;
      color: white;
    }
    .poll-result {
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      background: rgba(42,143,219,0.2);
      transition: width 0.5s;
    }
    .poll-text {
      position: relative;
      z-index: 1;
    }

    /* ===== File Upload ===== */
    .file-item {
      background: #f9f9f9;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 2px solid #eee;
    }
    .file-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .file-icon {
      font-size: 2em;
    }

    /* ===== Notification Panel ===== */
    .notification-panel {
      position: fixed;
      top: 70px;
      right: 20px;
      width: 350px;
      max-height: 500px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      display: none;
      z-index: 2000;
      overflow: hidden;
    }
    .notification-panel.active {
      display: block;
      animation: slideInRight 0.3s;
    }
    @keyframes slideInRight {
      from {transform: translateX(400px); opacity: 0;}
      to {transform: translateX(0); opacity: 1;}
    }
    .notification-header {
      background: #2a2d8f;
      color: white;
      padding: 15px 20px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .notification-list {
      max-height: 400px;
      overflow-y: auto;
    }
    .notification-item {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.3s;
    }
    .notification-item:hover {
      background: #f9f9f9;
    }
    .notification-item.unread {
      background: #e8f4fd;
    }

    /* ===== Add Content Button ===== */
    .add-content-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
      border: none;
      font-size: 2em;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(42,45,143,0.5);
      transition: all 0.3s;
      z-index: 100;
    }
    .add-content-btn:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 30px rgba(42,45,143,0.7);
    }

    /* ===== Modal ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      animation: fadeIn 0.3s;
    }
    .modal-content {
      background: white;
      margin: 3% auto;
      padding: 30px;
      border-radius: 15px;
      max-width: 600px;
      max-height: 85vh;
      overflow-y: auto;
      animation: slideDown 0.4s;
      position: relative;
    }
    @keyframes slideDown {
      from {opacity: 0; transform: translateY(-50px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .close {
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
      transition: color 0.3s;
    }
    .close:hover {
      color: #2a2d8f;
    }

    /* ===== Comments Section ===== */
    .comments-section {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
      display: none;
    }
    .comments-section.active {
      display: block;
    }
    .comment {
      background: white;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 3px solid #2a2d8f;
    }
    .comment-author {
      font-weight: bold;
      color: #2a2d8f;
      margin-bottom: 5px;
    }
    .comment-text {
      color: #555;
    }
    .comment-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-top: 10px;
    }

    /* ===== Stats ===== */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .stat-box {
      background: white;
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    .stat-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(42,45,143,0.3);
    }
    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: #2a2d8f;
      margin-bottom: 10px;
    }
    .stat-label {
      color: #666;
      font-size: 1em;
    }

    /* ===== Footer ===== */
    footer {
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, #2a2d8f, #4446b1);
      color: white;
      margin-top: 50px;
      box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
    }
    footer p {
      margin: 10px 0;
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      header h1 {font-size: 1.8em;}
      nav a {padding: 12px 15px; font-size: 0.9em;}
      .user-info {position: static; margin: 10px; justify-content: center;}
      .add-content-btn {width: 50px; height: 50px; font-size: 1.5em;}
      .notification-panel {width: 90%; right: 5%;}
      .calendar-grid {grid-template-columns: repeat(3, 1fr);}
    }
  </style>
</head>
<body>

<!-- ===== Login Page ===== -->
<div id="loginPage" class="login-container">
  <div class="login-box">
    <div class="login-header">
      <div class="login-icon">üéì</div>
      <h1>Welcome Back!</h1>
      <p>Laanqari Aisha High School Portal</p>
    </div>
    
    <div class="user-type-selector">
      <button class="user-type-btn active" onclick="selectUserType('student')">
        üë®‚Äçüéì Student
      </button>
      <button class="user-type-btn" onclick="selectUserType('teacher')">
        üë©‚Äçüè´ Teacher
      </button>
      <button class="user-type-btn" onclick="selectUserType('admin')">
        üîê Admin
      </button>
    </div>

    <div id="errorMessage" class="error-message"></div>
    <div id="successMessage" class="success-message"></div>

    <form id="loginForm" onsubmit="handleLogin(event)">
      <div class="form-group">
        <label for="username">Username</label>
        <span class="icon">üë§</span>
        <input type="text" id="username" name="username" placeholder="Enter your username" required>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <span class="icon">üîí</span>
        <input type="password" id="password" name="password" placeholder="Enter your password" required>
      </div>

      <button type="submit" class="login-btn">üöÄ Sign In</button>
    </form>

    <div class="login-footer">
      <p><a href="#" onclick="showForgotPassword()">Forgot Password?</a> | 
         <a href="#" onclick="showRegisterPage()">Create Account</a></p>
    </div>
  </div>
</div>

<!-- ===== Registration Page ===== -->
<div id="registerPage" class="login-container" style="display:none;">
  <div class="login-box">
    <div class="login-header">
      <div class="login-icon">üìù</div>
      <h1>Create Account</h1>
      <p>Join Laanqari Aisha High School Portal</p>
    </div>
    
    <div class="user-type-selector">
      <button class="user-type-btn active" onclick="selectRegisterType('student')">
        üë®‚Äçüéì Student
      </button>
      <button class="user-type-btn" onclick="selectRegisterType('teacher')">
        üë©‚Äçüè´ Teacher
      </button>
    </div>

    <div id="registerError" class="error-message"></div>
    <div id="registerSuccess" class="success-message"></div>

    <form id="registerForm" onsubmit="handleRegister(event)">
      <div class="form-group">
        <label for="regFullName">Full Name</label>
        <span class="icon">üë§</span>
        <input type="text" id="regFullName" placeholder="Enter your full name" required>
      </div>

      <div class="form-group">
        <label for="regEmail">Email</label>
        <span class="icon">‚úâÔ∏è</span>
        <input type="email" id="regEmail" placeholder="Enter your email" required>
      </div>

      <div class="form-group">
        <label for="regUsername">Username</label>
        <span class="icon">üë§</span>
        <input type="text" id="regUsername" placeholder="Choose a username" required minlength="4">
      </div>

      <div class="form-group">
        <label for="regPassword">Password</label>
        <span class="icon">üîí</span>
        <input type="password" id="regPassword" placeholder="Choose a password" required minlength="6">
      </div>

      <div class="form-group">
        <label for="regConfirmPassword">Confirm Password</label>
        <span class="icon">üîí</span>
        <input type="password" id="regConfirmPassword" placeholder="Confirm your password" required>
      </div>

      <div class="form-group" id="studentIdGroup">
        <label for="regStudentId">Student ID</label>
        <span class="icon">üéì</span>
        <input type="text" id="regStudentId" placeholder="e.g., 2026001, STU12345">
      </div>

      <div class="form-group" id="teacherCodeGroup" style="display:none;">
        <label for="regTeacherCode">Teacher Access Code</label>
        <span class="icon">üîê</span>
        <input type="text" id="regTeacherCode" placeholder="Enter teacher access code">
      </div>

      <button type="submit" class="login-btn">‚ú® Create Account</button>
    </form>

    <div class="login-footer">
      <p>Already have an account? <a href="#" onclick="showLoginPage()">Sign In</a></p>
      <p style="font-size: 0.85em; color: #999; margin-top: 10px;">
        Teacher Access Code: TEACH2026
      </p>
    </div>
  </div>
</div>

<!-- ===== Main Website ===== -->
<div id="mainWebsite" class="main-website">
  <header>
    <div class="user-info">
      <div class="notification-bell" onclick="toggleNotifications()">
        üîî
        <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
      </div>
      <span id="userDisplay" onclick="navigateTo('profile')">üë§ Guest</span>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
    <h1>üéì Laanqari Aisha High School</h1>
    <p>Excellence in Education Since 2000</p>
  </header>

  <!-- Notification Panel -->
  <div id="notificationPanel" class="notification-panel">
    <div class="notification-header">
      <span>üîî Notifications</span>
      <span style="cursor:pointer;" onclick="toggleNotifications()">‚úï</span>
    </div>
    <div class="notification-list" id="notificationList">
      <!-- Notifications will be added here -->
    </div>
  </div>

  <nav>
    <a onclick="navigateTo('home')" class="active">üè† Home</a>
    <a onclick="navigateTo('news')">üì∞ News</a>
    <a onclick="navigateTo('homework')">üìö Homework</a>
    <a onclick="navigateTo('calendar')">üìÖ Calendar</a>
    <a onclick="navigateTo('files')">üìÅ Files</a>
    <a onclick="navigateTo('polls')">üìä Polls</a>
    <a onclick="navigateTo('contact')">üìß Contact</a>
  </nav>

  <!-- Search Bar -->
  <div class="search-container">
    <input type="text" class="search-bar" id="searchBar" placeholder="üîç Search posts, homework, events..." onkeyup="handleSearch()">
  </div>

  <main>
    <!-- ===== Home Page ===== -->
    <div id="homePage" class="page active">
      <h2>Welcome to Our School</h2>
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-number">850</div>
          <div class="stat-label">Students</div>
        </div>
        <div class="stat-box">
          <div class="stat-number">45</div>
          <div class="stat-label">Teachers</div>
        </div>
        <div class="stat-box">
          <div class="stat-number">98</div>
          <div class="stat-label">Success Rate %</div>
        </div>
        <div class="stat-box">
          <div class="stat-number">26</div>
          <div class="stat-label">Years Established</div>
        </div>
      </div>

      <div class="card">
        <h3>üéì About Our School</h3>
        <p>Laanqari Aisha High School has been a beacon of excellence in education since 2000. We provide a nurturing environment where students can grow academically, socially, and personally.</p>
        <span class="badge">Established 2000</span>
        <span class="badge">Excellence</span>
      </div>
    </div>

    <!-- ===== Profile Page ===== -->
    <div id="profilePage" class="page">
      <h2>My Profile</h2>
      <div class="profile-card">
        <div class="profile-avatar" id="profileAvatar">üë§</div>
        <div class="profile-info">
          <h2 id="profileName">User Name</h2>
          <p id="profileEmail">user@email.com</p>
          <p id="profileRole">Student</p>
        </div>
        <button class="logout-btn" style="margin-top:20px;" onclick="showEditProfile()">‚úèÔ∏è Edit Profile</button>
      </div>

      <div class="card">
        <h3>üìä Your Activity</h3>
        <p>Posts: <strong id="userPosts">0</strong></p>
        <p>Comments: <strong id="userComments">0</strong></p>
        <p>Likes Given: <strong id="userLikes">0</strong></p>
      </div>
    </div>

    <!-- ===== News Page ===== -->
    <div id="newsPage" class="page">
      <h2>School News & Events</h2>
      <div id="newsContent"></div>
    </div>

    <!-- ===== Homework Page ===== -->
    <div id="homeworkPage" class="page">
      <h2>Homework & Assignments</h2>
      <div id="homeworkContent"></div>
    </div>

    <!-- ===== Calendar Page ===== -->
    <div id="calendarPage" class="page">
      <h2>School Calendar</h2>
      <div class="card">
        <h3>üìÖ Upcoming Events</h3>
        <div id="calendarContent"></div>
      </div>
    </div>

    <!-- ===== Files Page ===== -->
    <div id="filesPage" class="page">
      <h2>Shared Files & Documents</h2>
      <div id="filesContent"></div>
    </div>

    <!-- ===== Polls Page ===== -->
    <div id="pollsPage" class="page">
      <h2>Polls & Surveys</h2>
      <div id="pollsContent"></div>
    </div>

    <!-- ===== Contact Page ===== -->
    <div id="contactPage" class="page">
      <h2>Contact Us</h2>
      <div class="card">
        <h3>üìç School Address</h3>
        <p>Laanqari Aisha High School<br>
        Chlef Taougrit, Algeria</p>
      </div>
      <div class="card">
        <h3>üìû Contact Information</h3>
        <p>Phone: +213-0557522486<br>
        Email: info@laanqarischool.edu.dz</p>
      </div>
      <div class="card">
        <h3>üìß Send us a Message</h3>
        <form onsubmit="handleContactSubmit(event)">
          <div class="form-group">
            <label for="contactName">Name</label>
            <input type="text" id="contactName" style="padding-left:15px;" required>
          </div>
          <div class="form-group">
            <label for="contactEmail">Email</label>
            <input type="email" id="contactEmail" style="padding-left:15px;" required>
          </div>
          <div class="form-group">
            <label for="contactMessage">Message</label>
            <textarea id="contactMessage" required></textarea>
          </div>
          <button type="submit" class="btn-primary">Send Message</button>
        </form>
        <div id="contactFormMessage" class="success-message" style="margin-top: 15px;"></div>
      </div>
    </div>
  </main>

  <!-- Add Content Button (Only for Teachers and Admins) -->
  <button id="addContentBtn" class="add-content-btn" onclick="showAddContentModal()" style="display:none;">+</button>

  <!-- ===== Add Content Modal ===== -->
  <div id="addContentModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddContentModal()">&times;</span>
      <h2>Create New Content</h2>
      <form id="addContentForm" onsubmit="handleAddContent(event)">
        <div class="form-group">
          <label for="contentType">Content Type</label>
          <select id="contentType" onchange="updateContentForm()" required>
            <option value="post">üì∞ Post/News</option>
            <option value="homework">üìö Homework</option>
            <option value="event">üìÖ Event</option>
            <option value="file">üìÅ File</option>
            <option value="poll">üìä Poll</option>
          </select>
        </div>
        
        <div id="postFields">
          <div class="form-group">
            <label for="postTitle">Title</label>
            <input type="text" id="postTitle" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="postContent">Content</label>
            <textarea id="postContent" rows="5"></textarea>
          </div>
          <div class="form-group">
            <label for="postMedia">üì∑ Add Photo or Video (Optional)</label>
            <input type="file" id="postMedia" accept="image/*,video/*" onchange="previewMedia(event)" style="padding:12px;">
            <div id="mediaPreview" style="margin-top:15px; display:none;">
              <p style="font-weight:bold; color:#2a2d8f; margin-bottom:10px;">Preview:</p>
              <img id="imagePreview" style="max-width:100%; max-height:300px; border-radius:10px; display:none;">
              <video id="videoPreview" controls style="max-width:100%; max-height:300px; border-radius:10px; display:none;"></video>
              <button type="button" onclick="removeMedia()" style="margin-top:10px; padding:8px 16px; background:#f8d7da; color:#721c24; border:none; border-radius:8px; cursor:pointer;">‚ùå Remove Media</button>
            </div>
          </div>
          <div class="form-group">
            <label for="postTags">Tags (comma separated)</label>
            <input type="text" id="postTags" placeholder="e.g., Important, Upcoming" style="padding-left:15px;">
          </div>
        </div>

        <div id="homeworkFields" style="display:none;">
          <div class="form-group">
            <label for="hwTitle">Homework Title</label>
            <input type="text" id="hwTitle" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="hwDescription">Description</label>
            <textarea id="hwDescription" rows="5"></textarea>
          </div>
          <div class="form-group">
            <label for="hwDueDate">Due Date</label>
            <input type="date" id="hwDueDate" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="hwSubject">Subject</label>
            <input type="text" id="hwSubject" placeholder="e.g., Mathematics" style="padding-left:15px;">
          </div>
        </div>

        <div id="eventFields" style="display:none;">
          <div class="form-group">
            <label for="eventTitle">Event Title</label>
            <input type="text" id="eventTitle" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="eventDescription">Description</label>
            <textarea id="eventDescription" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="eventDate">Event Date</label>
            <input type="date" id="eventDate" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="eventLocation">Location</label>
            <input type="text" id="eventLocation" placeholder="e.g., School Hall" style="padding-left:15px;">
          </div>
        </div>

        <div id="fileFields" style="display:none;">
          <div class="form-group">
            <label for="fileTitle">File Title</label>
            <input type="text" id="fileTitle" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label for="fileDescription">Description</label>
            <textarea id="fileDescription" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="fileUpload">üìé Upload File</label>
            <input type="file" id="fileUpload" style="padding:12px;">
          </div>
          <div class="form-group">
            <label for="fileCategory">Category</label>
            <select id="fileCategory" style="padding-left:15px;">
              <option value="lesson">Lesson Materials</option>
              <option value="exam">Exams & Tests</option>
              <option value="general">General</option>
            </select>
          </div>
        </div>

        <div id="pollFields" style="display:none;">
          <div class="form-group">
            <label for="pollQuestion">Poll Question</label>
            <input type="text" id="pollQuestion" placeholder="What's your question?" style="padding-left:15px;">
          </div>
          <div class="form-group">
            <label>Poll Options</label>
            <input type="text" id="pollOption1" placeholder="Option 1" style="padding-left:15px; margin-bottom:10px;">
            <input type="text" id="pollOption2" placeholder="Option 2" style="padding-left:15px; margin-bottom:10px;">
            <input type="text" id="pollOption3" placeholder="Option 3" style="padding-left:15px; margin-bottom:10px;">
            <input type="text" id="pollOption4" placeholder="Option 4 (Optional)" style="padding-left:15px;">
          </div>
        </div>

        <button type="submit" class="btn-primary">üì§ Create</button>
      </form>
    </div>
  </div>

  <!-- ===== Edit Profile Modal ===== -->
  <div id="editProfileModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditProfile()">&times;</span>
      <h2>Edit Profile</h2>
      <form id="editProfileForm" onsubmit="handleEditProfile(event)">
        <div class="form-group">
          <label for="editFullName">Full Name</label>
          <input type="text" id="editFullName" style="padding-left:15px;" required>
        </div>
        <div class="form-group">
          <label for="editEmail">Email</label>
          <input type="email" id="editEmail" style="padding-left:15px;" required>
        </div>
        <div class="form-group">
          <label for="editBio">Bio</label>
          <textarea id="editBio" rows="4" placeholder="Tell us about yourself..."></textarea>
        </div>
        <button type="submit" class="btn-primary">üíæ Save Changes</button>
      </form>
    </div>
  </div>

  <footer>
    <p>&copy; 2026 Laanqari Aisha High School</p>
    <p>üìç Chlef Taougrit, Algeria | üìû +213-0557522486 | ‚úâÔ∏è info@laanqarischool.edu.dz</p>
  </footer>
</div>

<script>
  // ===== Data Storage =====
  let currentUser = null;
  let userType = 'student';
  let registerType = 'student';
  let currentPage = 'home';

  // Load data from localStorage
  let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
  let posts = JSON.parse(localStorage.getItem('schoolPosts')) || getDefaultPosts();
  let homework = JSON.parse(localStorage.getItem('schoolHomework')) || [];
  let events = JSON.parse(localStorage.getItem('schoolEvents')) || getDefaultEvents();
  let files = JSON.parse(localStorage.getItem('schoolFiles')) || [];
  let polls = JSON.parse(localStorage.getItem('schoolPolls')) || [];
  let notifications = JSON.parse(localStorage.getItem('schoolNotifications')) || [];

  function getDefaultPosts() {
    return [
      {
        id: 1,
        type: 'post',
        title: 'üî¨ Science Fair 2026',
        content: 'The annual science fair will take place on March 10. Students from all grades are encouraged to participate!',
        tags: ['Upcoming', 'Important'],
        author: 'Admin',
        date: new Date('2026-01-25').toISOString(),
        likes: 15,
        likedBy: [],
        comments: []
      }
    ];
  }

  function getDefaultEvents() {
    return [
      {
        id: 1,
        title: 'Science Fair 2026',
        description: 'Annual science fair for all grades',
        date: '2026-03-10',
        location: 'School Hall',
        author: 'Admin',
        createdAt: new Date().toISOString()
      },
      {
        id: 2,
        title: 'Sports Day',
        description: 'School-wide sports competitions',
        date: '2026-04-05',
        location: 'Sports Field',
        author: 'Admin',
        createdAt: new Date().toISOString()
      }
    ];
  }

  const validCredentials = {
    student: { username: 'student', password: 'student123' },
    teacher: { username: 'teacher', password: 'teacher123' },
    admin: { username: 'admin', password: 'admin123' }
  };

  // Check if user is already logged in
  function checkSession() {
    const savedSession = localStorage.getItem('currentSession');
    if (savedSession) {
      currentUser = JSON.parse(savedSession);
      showMainWebsite();
    }
  }

  function saveSession() {
    localStorage.setItem('currentSession', JSON.stringify(currentUser));
  }

  function clearSession() {
    localStorage.removeItem('currentSession');
  }

  window.addEventListener('DOMContentLoaded', function() {
    checkSession();
  });

  // ===== Authentication Functions =====
  function selectUserType(type) {
    userType = type;
    document.querySelectorAll('#loginPage .user-type-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');
  }

  function selectRegisterType(type) {
    registerType = type;
    document.querySelectorAll('#registerPage .user-type-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');

    if (type === 'student') {
      document.getElementById('studentIdGroup').style.display = 'block';
      document.getElementById('teacherCodeGroup').style.display = 'none';
      document.getElementById('regStudentId').required = true;
      document.getElementById('regTeacherCode').required = false;
    } else {
      document.getElementById('studentIdGroup').style.display = 'none';
      document.getElementById('teacherCodeGroup').style.display = 'block';
      document.getElementById('regStudentId').required = false;
      document.getElementById('regTeacherCode').required = true;
    }
  }

  function showRegisterPage() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('registerPage').style.display = 'flex';
  }

  function showLoginPage() {
    document.getElementById('registerPage').style.display = 'none';
    document.getElementById('loginPage').style.display = 'flex';
  }

  function handleRegister(event) {
    event.preventDefault();
    
    const fullName = document.getElementById('regFullName').value;
    const email = document.getElementById('regEmail').value;
    const username = document.getElementById('regUsername').value;
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regConfirmPassword').value;
    const studentId = document.getElementById('regStudentId').value;
    const teacherCode = document.getElementById('regTeacherCode').value;
    
    const errorMsg = document.getElementById('registerError');
    const successMsg = document.getElementById('registerSuccess');
    
    errorMsg.style.display = 'none';
    successMsg.style.display = 'none';

    if (password !== confirmPassword) {
      errorMsg.textContent = '‚ùå Passwords do not match!';
      errorMsg.style.display = 'block';
      return;
    }

    const existingUser = registeredUsers.find(u => u.username === username);
    if (existingUser || username === 'student' || username === 'teacher' || username === 'admin') {
      errorMsg.textContent = '‚ùå Username already exists!';
      errorMsg.style.display = 'block';
      return;
    }

    if (registerType === 'teacher' && teacherCode !== 'TEACH2026') {
      errorMsg.textContent = '‚ùå Invalid teacher access code!';
      errorMsg.style.display = 'block';
      return;
    }

    const newUser = {
      fullName: fullName,
      email: email,
      username: username,
      password: password,
      type: registerType,
      studentId: registerType === 'student' ? studentId : null,
      bio: '',
      createdAt: new Date().toISOString()
    };

    registeredUsers.push(newUser);
    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

    successMsg.textContent = `‚úÖ Account created successfully! Welcome ${fullName}!`;
    successMsg.style.display = 'block';

    document.getElementById('registerForm').reset();
    
    setTimeout(() => {
      showLoginPage();
      document.getElementById('username').value = username;
    }, 2000);
  }

  function handleLogin(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorMsg = document.getElementById('errorMessage');
    const successMsg = document.getElementById('successMessage');
    
    errorMsg.style.display = 'none';
    successMsg.style.display = 'none';

    const credentials = validCredentials[userType];
    
    if (username === credentials.username && password === credentials.password) {
      currentUser = {
        username: username,
        type: userType,
        displayName: userType.charAt(0).toUpperCase() + userType.slice(1),
        fullName: userType.charAt(0).toUpperCase() + userType.slice(1) + ' User',
        email: userType + '@school.edu.dz',
        bio: ''
      };
      
      successMsg.textContent = `‚úÖ Welcome ${currentUser.displayName}!`;
      successMsg.style.display = 'block';
      
      saveSession();
      
      setTimeout(() => {
        showMainWebsite();
      }, 1500);
      return;
    }

    const registeredUser = registeredUsers.find(u => 
      u.username === username && u.password === password && u.type === userType
    );

    if (registeredUser) {
      currentUser = {
        username: registeredUser.username,
        type: registeredUser.type,
        displayName: registeredUser.type.charAt(0).toUpperCase() + registeredUser.type.slice(1),
        fullName: registeredUser.fullName,
        email: registeredUser.email,
        bio: registeredUser.bio || ''
      };
      
      successMsg.textContent = `‚úÖ Welcome back ${registeredUser.fullName}!`;
      successMsg.style.display = 'block';
      
      saveSession();
      
      setTimeout(() => {
        showMainWebsite();
      }, 1500);
    } else {
      errorMsg.textContent = '‚ùå Invalid username or password.';
      errorMsg.style.display = 'block';
    }
  }

  function showMainWebsite() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('registerPage').style.display = 'none';
    document.getElementById('mainWebsite').style.display = 'block';
    
    const userIcon = currentUser.type === 'admin' ? 'üîê' : 
                     currentUser.type === 'teacher' ? 'üë©‚Äçüè´' : 'üë®‚Äçüéì';
    
    document.getElementById('userDisplay').textContent = `${userIcon} ${currentUser.fullName}`;
    
    if (currentUser.type === 'teacher' || currentUser.type === 'admin') {
      document.getElementById('addContentBtn').style.display = 'block';
    }
    
    updateNotifications();
    renderPage(currentPage);
  }

  function logout() {
    if (confirm('Are you sure you want to logout?')) {
      currentUser = null;
      clearSession();
      document.getElementById('mainWebsite').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('addContentBtn').style.display = 'none';
    }
  }

  function showForgotPassword() {
    alert('Please contact admin@laanqarischool.edu.dz to reset your password.');
  }

  // ===== Navigation =====
  function navigateTo(page) {
    currentPage = page;
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    
    document.getElementById(page + 'Page').classList.add('active');
    const navLinks = document.querySelectorAll('nav a');
    navLinks.forEach(link => {
      if (link.textContent.toLowerCase().includes(page.toLowerCase()) || 
          (page === 'home' && link.textContent.includes('Home'))) {
        link.classList.add('active');
      }
    });
    
    renderPage(page);
  }

  function renderPage(page) {
    if (page === 'news') {
      renderPosts();
    } else if (page === 'homework') {
      renderHomework();
    } else if (page === 'calendar') {
      renderCalendar();
    } else if (page === 'files') {
      renderFiles();
    } else if (page === 'polls') {
      renderPolls();
    } else if (page === 'profile') {
      renderProfile();
    }
  }

  // ===== Profile Functions =====
  function renderProfile() {
    const icon = currentUser.type === 'admin' ? 'üîê' : 
                 currentUser.type === 'teacher' ? 'üë©‚Äçüè´' : 'üë®‚Äçüéì';
    
    document.getElementById('profileAvatar').textContent = icon;
    document.getElementById('profileName').textContent = currentUser.fullName;
    document.getElementById('profileEmail').textContent = currentUser.email;
    document.getElementById('profileRole').textContent = currentUser.type.charAt(0).toUpperCase() + currentUser.type.slice(1);

    // Calculate user stats
    const userPosts = posts.filter(p => p.author === currentUser.fullName).length;
    const userComments = posts.reduce((total, p) => total + p.comments.filter(c => c.author === currentUser.fullName).length, 0);
    const userLikes = posts.reduce((total, p) => total + (p.likedBy?.includes(currentUser.username) ? 1 : 0), 0);

    document.getElementById('userPosts').textContent = userPosts;
    document.getElementById('userComments').textContent = userComments;
    document.getElementById('userLikes').textContent = userLikes;
  }

  function showEditProfile() {
    document.getElementById('editProfileModal').style.display = 'block';
    document.getElementById('editFullName').value = currentUser.fullName;
    document.getElementById('editEmail').value = currentUser.email;
    document.getElementById('editBio').value = currentUser.bio || '';
  }

  function closeEditProfile() {
    document.getElementById('editProfileModal').style.display = 'none';
  }

  function handleEditProfile(event) {
    event.preventDefault();
    
    currentUser.fullName = document.getElementById('editFullName').value;
    currentUser.email = document.getElementById('editEmail').value;
    currentUser.bio = document.getElementById('editBio').value;
    
    // Update in registered users
    const userIndex = registeredUsers.findIndex(u => u.username === currentUser.username);
    if (userIndex !== -1) {
      registeredUsers[userIndex].fullName = currentUser.fullName;
      registeredUsers[userIndex].email = currentUser.email;
      registeredUsers[userIndex].bio = currentUser.bio;
      localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
    }
    
    saveSession();
    document.getElementById('userDisplay').textContent = `${currentUser.type === 'admin' ? 'üîê' : currentUser.type === 'teacher' ? 'üë©‚Äçüè´' : 'üë®‚Äçüéì'} ${currentUser.fullName}`;
    
    closeEditProfile();
    renderProfile();
    alert('‚úÖ Profile updated successfully!');
  }

  // ===== Posts Functions =====
  function renderPosts() {
    const container = document.getElementById('newsContent');
    const sortedPosts = posts.filter(p => p.type === 'post').sort((a, b) => new Date(b.date) - new Date(a.date));
    
    if (sortedPosts.length === 0) {
      container.innerHTML = '<div class="card"><p>No posts yet. Teachers and admins can add content!</p></div>';
      return;
    }
    
    container.innerHTML = sortedPosts.map(post => {
      const isLiked = post.likedBy && post.likedBy.includes(currentUser?.username);
      const canDelete = currentUser && (currentUser.type === 'admin' || post.author === currentUser.fullName);
      
      return `
        <div class="card">
          <h3>${post.title}</h3>
          <p>${post.content}</p>
          ${post.mediaData ? (post.mediaType.startsWith('image') ? 
            `<img src="${post.mediaData}" style="max-width:100%; max-height:400px; border-radius:10px; margin:15px 0;">` : 
            `<video controls style="max-width:100%; max-height:400px; border-radius:10px; margin:15px 0;">
              <source src="${post.mediaData}" type="${post.mediaType}">
            </video>`) : ''}
          ${post.tags.map(tag => `<span class="badge">${tag}</span>`).join('')}
          <div class="card-meta">
            <span>üìù ${post.author} | üìÖ ${new Date(post.date).toLocaleDateString()}</span>
            <span>‚ù§Ô∏è ${post.likes} | üí¨ ${post.comments.length}</span>
          </div>
          <div class="card-actions">
            <button class="btn-small btn-like ${isLiked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
              ${isLiked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
            </button>
            <button class="btn-small btn-comment" onclick="toggleComments(${post.id})">
              üí¨ Comment
            </button>
            ${canDelete ? `<button class="btn-small btn-delete" onclick="deleteItem('post', ${post.id})">üóëÔ∏è Delete</button>` : ''}
          </div>
          <div class="comments-section" id="comments-${post.id}">
            ${post.comments.map(c => `
              <div class="comment">
                <div class="comment-author">${c.author}</div>
                <div class="comment-text">${c.text}</div>
              </div>
            `).join('')}
            <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write a comment...">
            <button class="btn-small btn-comment" style="margin-top:10px;" onclick="addComment(${post.id})">Post Comment</button>
          </div>
        </div>
      `;
    }).join('');
  }

  function toggleLike(postId) {
    if (!currentUser) return;
    
    const post = posts.find(p => p.id === postId);
    if (!post) return;
    
    if (!post.likedBy) post.likedBy = [];
    
    const index = post.likedBy.indexOf(currentUser.username);
    if (index > -1) {
      post.likedBy.splice(index, 1);
      post.likes--;
    } else {
      post.likedBy.push(currentUser.username);
      post.likes++;
      addNotification(`${currentUser.fullName} liked your post "${post.title}"`, post.author);
    }
    
    savePosts();
    renderPage(currentPage);
  }

  function toggleComments(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    commentsSection.classList.toggle('active');
  }

  function addComment(postId) {
    if (!currentUser) return;
    
    const input = document.getElementById(`comment-input-${postId}`);
    const text = input.value.trim();
    
    if (!text) return;
    
    const post = posts.find(p => p.id === postId);
    if (!post) return;
    
    post.comments.push({
      author: currentUser.fullName,
      text: text,
      date: new Date().toISOString()
    });
    
    addNotification(`${currentUser.fullName} commented on your post "${post.title}"`, post.author);
    
    savePosts();
    input.value = '';
    renderPage(currentPage);
  }

  // ===== Homework Functions =====
  function renderHomework() {
    const container = document.getElementById('homeworkContent');
    const sortedHomework = homework.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
    
    if (sortedHomework.length === 0) {
      container.innerHTML = '<div class="card"><p>No homework assigned yet.</p></div>';
      return;
    }
    
    container.innerHTML = sortedHomework.map(hw => {
      const dueDate = new Date(hw.dueDate);
      const today = new Date();
      const isOverdue = dueDate < today && !hw.submitted;
      const isSubmitted = hw.submissions?.some(s => s.student === currentUser.username);
      const canDelete = currentUser && (currentUser.type === 'admin' || hw.author === currentUser.fullName);
      
      let cardClass = 'card homework-card';
      if (isSubmitted) cardClass += ' submitted';
      else if (isOverdue) cardClass += ' overdue';
      
      return `
        <div class="${cardClass}">
          <h3>üìö ${hw.title}</h3>
          <p>${hw.description}</p>
          <span class="badge">${hw.subject}</span>
          <span class="badge">Due: ${dueDate.toLocaleDateString()}</span>
          ${isSubmitted ? '<span class="badge" style="background:#4caf50;">‚úÖ Submitted</span>' : ''}
          ${isOverdue && !isSubmitted ? '<span class="badge" style="background:#f44336;">‚ö†Ô∏è Overdue</span>' : ''}
          <div class="card-meta">
            <span>üìù By ${hw.author}</span>
            <span>${hw.submissions?.length || 0} submissions</span>
          </div>
          <div class="card-actions">
            ${currentUser.type === 'student' && !isSubmitted ? 
              `<button class="btn-small btn-download" onclick="submitHomework(${hw.id})">üì§ Submit</button>` : ''}
            ${canDelete ? `<button class="btn-small btn-delete" onclick="deleteItem('homework', ${hw.id})">üóëÔ∏è Delete</button>` : ''}
          </div>
        </div>
      `;
    }).join('');
  }

  function submitHomework(hwId) {
    const hw = homework.find(h => h.id === hwId);
    if (!hw) return;
    
    if (!hw.submissions) hw.submissions = [];
    
    hw.submissions.push({
      student: currentUser.username,
      studentName: currentUser.fullName,
      date: new Date().toISOString()
    });
    
    addNotification(`${currentUser.fullName} submitted homework: ${hw.title}`, hw.author);
    
    saveHomework();
    renderHomework();
    alert('‚úÖ Homework submitted successfully!');
  }

  // ===== Calendar Functions =====
  function renderCalendar() {
    const container = document.getElementById('calendarContent');
    const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));
    
    if (sortedEvents.length === 0) {
      container.innerHTML = '<p>No events scheduled.</p>';
      return;
    }
    
    container.innerHTML = sortedEvents.map(event => {
      const eventDate = new Date(event.date);
      const canDelete = currentUser && (currentUser.type === 'admin' || event.author === currentUser.fullName);
      
      return `
        <div class="card">
          <h3>üìÖ ${event.title}</h3>
          <p>${event.description}</p>
          <span class="badge">üìç ${event.location}</span>
          <span class="badge">üìÜ ${eventDate.toLocaleDateString()}</span>
          <div class="card-meta">
            <span>Created by ${event.author}</span>
          </div>
          ${canDelete ? `
            <div class="card-actions">
              <button class="btn-small btn-delete" onclick="deleteItem('event', ${event.id})">üóëÔ∏è Delete</button>
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  // ===== Files Functions =====
  function renderFiles() {
    const container = document.getElementById('filesContent');
    
    if (files.length === 0) {
      container.innerHTML = '<div class="card"><p>No files shared yet.</p></div>';
      return;
    }
    
    container.innerHTML = files.map(file => {
      const canDelete = currentUser && (currentUser.type === 'admin' || file.author === currentUser.fullName);
      
      return `
        <div class="card">
          <h3>üìÅ ${file.title}</h3>
          <p>${file.description}</p>
          <span class="badge">${file.category}</span>
          <span class="badge">üìé ${file.fileName}</span>
          <div class="card-meta">
            <span>üìù By ${file.author} | üìÖ ${new Date(file.date).toLocaleDateString()}</span>
          </div>
          <div class="card-actions">
            <button class="btn-small btn-download" onclick="downloadFile(${file.id})">‚¨áÔ∏è Download</button>
            ${canDelete ? `<button class="btn-small btn-delete" onclick="deleteItem('file', ${file.id})">üóëÔ∏è Delete</button>` : ''}
          </div>
        </div>
      `;
    }).join('');
  }

  function downloadFile(fileId) {
    const file = files.find(f => f.id === fileId);
    if (!file || !file.fileData) return;
    
    const link = document.createElement('a');
    link.href = file.fileData;
    link.download = file.fileName;
    link.click();
  }

  // ===== Polls Functions =====
  function renderPolls() {
    const container = document.getElementById('pollsContent');
    
    if (polls.length === 0) {
      container.innerHTML = '<div class="card"><p>No polls available.</p></div>';
      return;
    }
    
    container.innerHTML = polls.map(poll => {
      const hasVoted = poll.votes?.some(v => v.user === currentUser.username);
      const totalVotes = poll.votes?.length || 0;
      const canDelete = currentUser && (currentUser.type === 'admin' || poll.author === currentUser.fullName);
      
      return `
        <div class="card">
          <h3>üìä ${poll.question}</h3>
          <div style="margin:20px 0;">
            ${poll.options.map((option, index) => {
              const optionVotes = poll.votes?.filter(v => v.option === index).length || 0;
              const percentage = totalVotes > 0 ? Math.round((optionVotes / totalVotes) * 100) : 0;
              const userVoted = poll.votes?.some(v => v.user === currentUser.username && v.option === index);
              
              if (hasVoted) {
                return `
                  <div class="poll-option ${userVoted ? 'selected' : ''}" style="position:relative;">
                    <div class="poll-result" style="width:${percentage}%;"></div>
                    <div class="poll-text">${option} - ${percentage}% (${optionVotes} votes)</div>
                  </div>
                `;
              } else {
                return `
                  <div class="poll-option" onclick="votePoll(${poll.id}, ${index})">
                    <div class="poll-text">${option}</div>
                  </div>
                `;
              }
            }).join('')}
          </div>
          <div class="card-meta">
            <span>üìù By ${poll.author}</span>
            <span>üó≥Ô∏è ${totalVotes} votes</span>
          </div>
          ${canDelete ? `
            <div class="card-actions">
              <button class="btn-small btn-delete" onclick="deleteItem('poll', ${poll.id})">üóëÔ∏è Delete</button>
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  function votePoll(pollId, optionIndex) {
    if (!currentUser) return;
    
    const poll = polls.find(p => p.id === pollId);
    if (!poll) return;
    
    if (!poll.votes) poll.votes = [];
    
    if (poll.votes.some(v => v.user === currentUser.username)) {
      alert('You have already voted!');
      return;
    }
    
    poll.votes.push({
      user: currentUser.username,
      option: optionIndex,
      date: new Date().toISOString()
    });
    
    addNotification(`${currentUser.fullName} voted on your poll`, poll.author);
    
    savePolls();
    renderPolls();
  }

  // ===== Search Function =====
  function handleSearch() {
    const query = document.getElementById('searchBar').value.toLowerCase();
    
    if (!query) {
      renderPage(currentPage);
      return;
    }
    
    // Search in posts
    if (currentPage === 'news') {
      const filtered = posts.filter(p => 
        p.type === 'post' && 
        (p.title.toLowerCase().includes(query) || 
         p.content.toLowerCase().includes(query) ||
         p.tags.some(t => t.toLowerCase().includes(query)))
      );
      
      const container = document.getElementById('newsContent');
      if (filtered.length === 0) {
        container.innerHTML = '<div class="card"><p>No results found.</p></div>';
      } else {
        // Re-render with filtered results
        container.innerHTML = filtered.map(post => {
          const isLiked = post.likedBy && post.likedBy.includes(currentUser?.username);
          const canDelete = currentUser && (currentUser.type === 'admin' || post.author === currentUser.fullName);
          
          return `
            <div class="card">
              <h3>${post.title}</h3>
              <p>${post.content}</p>
              ${post.tags.map(tag => `<span class="badge">${tag}</span>`).join('')}
              <div class="card-actions">
                <button class="btn-small btn-like ${isLiked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
                  ${isLiked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
                </button>
              </div>
            </div>
          `;
        }).join('');
      }
    }
    
    // Search in homework
    if (currentPage === 'homework') {
      const filtered = homework.filter(hw => 
        hw.title.toLowerCase().includes(query) || 
        hw.description.toLowerCase().includes(query) ||
        hw.subject.toLowerCase().includes(query)
      );
      
      const container = document.getElementById('homeworkContent');
      if (filtered.length === 0) {
        container.innerHTML = '<div class="card"><p>No results found.</p></div>';
      } else {
        renderHomework();
      }
    }
  }

  // ===== Notifications =====
  function addNotification(message, recipient) {
    if (recipient === currentUser.fullName) return; // Don't notify yourself
    
    notifications.push({
      id: Date.now(),
      message: message,
      recipient: recipient,
      date: new Date().toISOString(),
      read: false
    });
    
    localStorage.setItem('schoolNotifications', JSON.stringify(notifications));
    updateNotifications();
  }

  function updateNotifications() {
    if (!currentUser) return;
    
    const userNotifications = notifications.filter(n => 
      n.recipient === currentUser.fullName && !n.read
    );
    
    const badge = document.getElementById('notificationBadge');
    if (userNotifications.length > 0) {
      badge.textContent = userNotifications.length;
      badge.style.display = 'flex';
    } else {
      badge.style.display = 'none';
    }
    
    renderNotifications();
  }

  function renderNotifications() {
    if (!currentUser) return;
    
    const userNotifications = notifications
      .filter(n => n.recipient === currentUser.fullName)
      .sort((a, b) => new Date(b.date) - new Date(a.date))
      .slice(0, 10);
    
    const container = document.getElementById('notificationList');
    
    if (userNotifications.length === 0) {
      container.innerHTML = '<div class="notification-item">No notifications yet.</div>';
      return;
    }
    
    container.innerHTML = userNotifications.map(notif => `
      <div class="notification-item ${!notif.read ? 'unread' : ''}" onclick="markAsRead(${notif.id})">
        <div>${notif.message}</div>
        <div style="font-size:0.85em; color:#999; margin-top:5px;">
          ${new Date(notif.date).toLocaleString()}
        </div>
      </div>
    `).join('');
  }

  function toggleNotifications() {
    const panel = document.getElementById('notificationPanel');
    panel.classList.toggle('active');
  }

  function markAsRead(notifId) {
    const notif = notifications.find(n => n.id === notifId);
    if (notif) {
      notif.read = true;
      localStorage.setItem('schoolNotifications', JSON.stringify(notifications));
      updateNotifications();
    }
  }

  // ===== Add Content Functions =====
  let currentMediaData = null;
  let currentMediaType = null;

  function showAddContentModal() {
    document.getElementById('addContentModal').style.display = 'block';
  }

  function closeAddContentModal() {
    document.getElementById('addContentModal').style.display = 'none';
    document.getElementById('addContentForm').reset();
    removeMedia();
  }

  function updateContentForm() {
    const type = document.getElementById('contentType').value;
    
    document.getElementById('postFields').style.display = type === 'post' ? 'block' : 'none';
    document.getElementById('homeworkFields').style.display = type === 'homework' ? 'block' : 'none';
    document.getElementById('eventFields').style.display = type === 'event' ? 'block' : 'none';
    document.getElementById('fileFields').style.display = type === 'file' ? 'block' : 'none';
    document.getElementById('pollFields').style.display = type === 'poll' ? 'block' : 'none';
  }

  function previewMedia(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    
    reader.onload = function(e) {
      currentMediaData = e.target.result;
      currentMediaType = file.type;
      
      const preview = document.getElementById('mediaPreview');
      const imagePreview = document.getElementById('imagePreview');
      const videoPreview = document.getElementById('videoPreview');
      
      preview.style.display = 'block';
      
      if (file.type.startsWith('image/')) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        videoPreview.style.display = 'none';
      } else if (file.type.startsWith('video/')) {
        videoPreview.src = e.target.result;
        videoPreview.style.display = 'block';
        imagePreview.style.display = 'none';
      }
    };
    
    reader.readAsDataURL(file);
  }

  function removeMedia() {
    currentMediaData = null;
    currentMediaType = null;
    document.getElementById('postMedia').value = '';
    document.getElementById('mediaPreview').style.display = 'none';
  }

  function handleAddContent(event) {
    event.preventDefault();
    
    if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
      alert('Only teachers and admins can post content!');
      return;
    }
    
    const type = document.getElementById('contentType').value;
    
    if (type === 'post') {
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const tags = document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t);
      
      posts.unshift({
        id: Date.now(),
        type: 'post',
        title: title,
        content: content,
        tags: tags,
        author: currentUser.fullName,
        date: new Date().toISOString(),
        likes: 0,
        likedBy: [],
        comments: [],
        mediaData: currentMediaData,
        mediaType: currentMediaType
      });
      
      savePosts();
      navigateTo('news');
    } 
    else if (type === 'homework') {
      const title = document.getElementById('hwTitle').value;
      const description = document.getElementById('hwDescription').value;
      const dueDate = document.getElementById('hwDueDate').value;
      const subject = document.getElementById('hwSubject').value;
      
      homework.push({
        id: Date.now(),
        title: title,
        description: description,
        dueDate: dueDate,
        subject: subject,
        author: currentUser.fullName,
        date: new Date().toISOString(),
        submissions: []
      });
      
      saveHomework();
      navigateTo('homework');
      
      // Notify all students
      addNotification(`New homework assigned: ${title}`, 'all_students');
    }
    else if (type === 'event') {
      const title = document.getElementById('eventTitle').value;
      const description = document.getElementById('eventDescription').value;
      const date = document.getElementById('eventDate').value;
      const location = document.getElementById('eventLocation').value;
      
      events.push({
        id: Date.now(),
        title: title,
        description: description,
        date: date,
        location: location,
        author: currentUser.fullName,
        createdAt: new Date().toISOString()
      });
      
      saveEvents();
      navigateTo('calendar');
    }
    else if (type === 'file') {
      const fileInput = document.getElementById('fileUpload');
      if (!fileInput.files[0]) {
        alert('Please select a file to upload!');
        return;
      }
      
      const title = document.getElementById('fileTitle').value;
      const description = document.getElementById('fileDescription').value;
      const category = document.getElementById('fileCategory').value;
      const file = fileInput.files[0];
      
      const reader = new FileReader();
      reader.onload = function(e) {
        files.push({
          id: Date.now(),
          title: title,
          description: description,
          category: category,
          fileName: file.name,
          fileData: e.target.result,
          author: currentUser.fullName,
          date: new Date().toISOString()
        });
        
        saveFiles();
        navigateTo('files');
      };
      reader.readAsDataURL(file);
    }
    else if (type === 'poll') {
      const question = document.getElementById('pollQuestion').value;
      const options = [
        document.getElementById('pollOption1').value,
        document.getElementById('pollOption2').value,
        document.getElementById('pollOption3').value,
        document.getElementById('pollOption4').value
      ].filter(o => o.trim());
      
      if (options.length < 2) {
        alert('Please provide at least 2 options!');
        return;
      }
      
      polls.push({
        id: Date.now(),
        question: question,
        options: options,
        author: currentUser.fullName,
        date: new Date().toISOString(),
        votes: []
      });
      
      savePolls();
      navigateTo('polls');
    }
    
    closeAddContentModal();
  }

  // ===== Delete Functions =====
  function deleteItem(type, id) {
    if (!confirm('Are you sure you want to delete this?')) return;
    
    if (type === 'post') {
      posts = posts.filter(p => p.id !== id);
      savePosts();
      renderPosts();
    } else if (type === 'homework') {
      homework = homework.filter(h => h.id !== id);
      saveHomework();
      renderHomework();
    } else if (type === 'event') {
      events = events.filter(e => e.id !== id);
      saveEvents();
      renderCalendar();
    } else if (type === 'file') {
      files = files.filter(f => f.id !== id);
      saveFiles();
      renderFiles();
    } else if (type === 'poll') {
      polls = polls.filter(p => p.id !== id);
      savePolls();
      renderPolls();
    }
  }

  // ===== Save Functions =====
  function savePosts() {
    localStorage.setItem('schoolPosts', JSON.stringify(posts));
  }

  function saveHomework() {
    localStorage.setItem('schoolHomework', JSON.stringify(homework));
  }

  function saveEvents() {
    localStorage.setItem('schoolEvents', JSON.stringify(events));
  }

  function saveFiles() {
    localStorage.setItem('schoolFiles', JSON.stringify(files));
  }

  function savePolls() {
    localStorage.setItem('schoolPolls', JSON.stringify(polls));
  }

  // ===== Contact Form =====
  function handleContactSubmit(event) {
    event.preventDefault();
    const msg = document.getElementById('contactFormMessage');
    msg.textContent = '‚úÖ Message sent successfully!';
    msg.style.display = 'block';
    event.target.reset();
    setTimeout(() => {
      msg.style.display = 'none';
    }, 5000);
  }

  // ===== Close modals =====
  window.onclick = function(event) {
    const addModal = document.getElementById('addContentModal');
    const editModal = document.getElementById('editProfileModal');
    if (event.target == addModal) {
      closeAddContentModal();
    }
    if (event.target == editModal) {
      closeEditProfile();
    }
  }
</script>

</body>
</html>
